{% extends 'layouts/layout-application.html' %}

{% block pageTitle %}
Patient details
{% endblock %}

{% block beforeContent %}

<div class="nhsuk-full-width-container">
  <div class='scra-bordered-tabs-container'>
    <div class="nhsuk-width-container-fluid">
      <ul class="scra-bordered-tabs">
        <li class="scra-bordered-tabs-item">
          <a class="scra-bordered-tabs-link" href="patient-overview">Overview</a>
        </li>
        <li class="scra-bordered-tabs-item scra-bordered-tabs-item-active">
          <a class="scra-bordered-tabs-link" href="#">Patient</a>
        </li>
        <li class="scra-bordered-tabs-item">
          <a class="scra-bordered-tabs-link" href="patient-clinical">Clinical</a>
        </li>
        <li class="scra-bordered-tabs-item">
          <a class="scra-bordered-tabs-link" href="#">Documents</a>
        </li>
      </ul>
    </div>
  </div>
</div>

{% endblock %}

{% block content %}

{% include "includes/mobile-nav.html" %}

<div class="nhsuk-grid-row">

  <div class="nhsuk-width-container">

    <div class="nhsuk-grid-column-full patient-details-content">
      <h1 class="nhsuk-heading-l">Edit patient addresses</h1>

      <div class='nhsuk-u-reading-width'>

        <section id="usual-address" title="Usual address">


          <div class="scra-card pds-edit-card">
            <div class="scra-card-header pds-edit-card-header">
              <h2 class="nhsuk-heading-m" id="edit-key-details">Addresses</h2>
            </div>
            <div class="scra-card-content">
              <div class="nhsuk-u-reading-width">
              </div>
              <dl class="nhsuk-summary-list">

                <div class="nhsuk-summary-list__row">
                  <dt class="nhsuk-summary-list__key ">
                    Usual address
                  </dt>
                  <dd class="nhsuk-summary-list__value">
                    <div id="usual-address-value" class="card-content-detail-address">

                    </div>
                    <div class="usual-address-section" style="display:none;">
                      <div class="nhsuk-form-group pds-edit-form-group">
                        <p class="pds-edit-hint nhsuk-body-s">
                          A patient should always have a usual address.
                        </p>
                        <div class="nhsuk-form-group nhsuk-u-margin-bottom-4">
                          <fieldset class="nhsuk-fieldset">
                            <legend class="nhsuk-fieldset__legend nhsuk-label__strong">
                              Select an address type
                            </legend>

                            <div class="nhsuk-radios nhsuk-radios--inline nhsuk-gender--radios" id="gender-radio">
                              <div class="nhsuk-radios__item">
                                <input class="nhsuk-radios__input" id="address-type-uk" name="address-type" type="radio" value="uk" checked="checked">
                                <label class="nhsuk-label nhsuk-radios__label" for="address-type-uk">
                                  UK Address
                                </label>
                              </div>
                              <div class="nhsuk-radios__item">
                                <input class="nhsuk-radios__input" id="address-type-overseas" name="address-type" type="radio" value="overseas">
                                <label class="nhsuk-label nhsuk-radios__label" for="address-type-overseas">
                                  Overseas address
                                </label>
                              </div>
                              <div class="nhsuk-radios__item">
                                <input class="nhsuk-radios__input" id="address-type-nfa" name="address-type" type="radio" value="nfa">
                                <label class="nhsuk-label nhsuk-radios__label" for="address-type-nfa">
                                  No fixed abode
                                </label>
                              </div>
                            </div>
                          </fieldset>
                        </div>
                        <form id="edit-usual-address-form">
                          <label class="nhsuk-label nhsuk-label__strong" for="pds-edit-house-name">
                            Building and street
                          </label>
                          <input class="nhsuk-input nhsuk-input--width-20" id="pds-edit-house-name" name="pdf-edit-house-name" type="text" value="1 Town Street"><br />
                          <input class="nhsuk-input nhsuk-input--width-20" id="pds-edit-number" name="pdf-edit-number" type="text">

                          <label class="nhsuk-label nhsuk-label__strong" for="pds-edit-locality">
                            Locality
                          </label>
                          <input class="nhsuk-input nhsuk-input--width-15" id="pds-edit-locality" name="pdf-edit-locality" type="text">

                          <label class="nhsuk-label nhsuk-label__strong" for="pds-edit-post-town">
                            Post town
                          </label>
                          <input class="nhsuk-input nhsuk-input--width-15" id="pds-edit-post-town" name="pdf-edit-post-town" type="text" value="Straford-upon-Avon">

                          <label class="nhsuk-label nhsuk-label__strong" for="pds-edit-county">
                            County
                          </label>
                          <input class="nhsuk-input nhsuk-input--width-15" id="pds-edit-county" name="pdf-edit-county" type="text" value="Warwickshire">

                          <label class="nhsuk-label nhsuk-label__strong" for="pds-edit-postcode">
                            Postcode
                          </label>
                          <input class="nhsuk-input nhsuk-input--width-10" id="pds-edit-postcode" name="pdf-edit-postcode" type="text" value="AB1 2CD">

                          <details class="nhsuk-details" style="margin-top:24px; width: 200%;">
                            <summary class="nhsuk-details__summary">
                              <span class="nhsuk-details__summary-text">
                                Find an address or postcode
                              </span>
                            </summary>
                            <div class="nhsuk-details__text">
                              <div class="lookup-search-results">
                                <div class="nhsuk-u-reading-width">
                                  <label class="nhsuk-label nhsuk-label__strong" for="address-lookup">
                                    Enter part of an address or postcode
                                  </label>
                                  <input type="search" id="address-lookup" class="form-control nhsuk-input nhsuk-input--width-15" />
                                  <!--<p><a href="#usual-address" id="cancel-adding-usual-address" >Clear</a></p>-->
                                </div>
                              </div>

                            </div>
                          </details>


                          <fieldset class="nhsuk-fieldset" role="group">
                            <legend class="nhsuk-fieldset__legend nhsuk-label__strong">
                              Effective from
                            </legend>

                            <div class="nhsuk-date-input" id="effective-from-date-name">
                              <div class="nhsuk-date-input__item">
                                <div class="nhsuk-form-group">
                                  <label class="nhsuk-label nhsuk-date-input__label" for="effective-from-date-name-day">
                                    Day
                                  </label>
                                  <input class="nhsuk-input nhsuk-date-input__input nhsuk-input--width-2" id="effective-from-date-name-day" name="effective-from-date-name-day" type="number" pattern="[0-9]*">
                                </div>
                              </div>
                              <div class="nhsuk-date-input__item">
                                <div class="nhsuk-form-group">
                                  <label class="nhsuk-label nhsuk-date-input__label" for="effective-from-date-name-month">
                                    Month
                                  </label>
                                  <input class="nhsuk-input nhsuk-date-input__input nhsuk-input--width-2" id="effective-from-date-name-month" name="effective-from-date-name-month" type="number" pattern="[0-9]*">
                                </div>
                              </div>
                              <div class="nhsuk-date-input__item">
                                <div class="nhsuk-form-group">
                                  <label class="nhsuk-label nhsuk-date-input__label" for="effective-from-date-name-year">
                                    Year
                                  </label>
                                  <input class="nhsuk-input nhsuk-date-input__input nhsuk-input--width-4" id="effective-from-date-name-year" name="effective-from-date-name-year" type="number" pattern="[0-9]*">
                                </div>
                              </div>
                            </div>
                          </fieldset>

                          <fieldset class="nhsuk-fieldset" role="group">
                            <legend class="nhsuk-fieldset__legend nhsuk-label__strong">
                              Effective to
                            </legend>

                            <div class="nhsuk-date-input" id="effective-date-name">
                              <div class="nhsuk-date-input__item">
                                <div class="nhsuk-form-group">
                                  <label class="nhsuk-label nhsuk-date-input__label" for="effective-date-name-day">
                                    Day
                                  </label>
                                  <input class="nhsuk-input nhsuk-date-input__input nhsuk-input--width-2" id="effective-date-name-day" name="effective-date-name-day" type="number" pattern="[0-9]*">
                                </div>
                              </div>
                              <div class="nhsuk-date-input__item">
                                <div class="nhsuk-form-group">
                                  <label class="nhsuk-label nhsuk-date-input__label" for="effective-date-name-month">
                                    Month
                                  </label>
                                  <input class="nhsuk-input nhsuk-date-input__input nhsuk-input--width-2" id="effective-date-name-month" name="effective-date-name-month" type="number" pattern="[0-9]*">
                                </div>
                              </div>
                              <div class="nhsuk-date-input__item">
                                <div class="nhsuk-form-group">
                                  <label class="nhsuk-label nhsuk-date-input__label" for="effective-date-name-year">
                                    Year
                                  </label>
                                  <input class="nhsuk-input nhsuk-date-input__input nhsuk-input--width-4" id="effective-date-name-year" name="effective-date-name-year" type="number" pattern="[0-9]*">
                                </div>
                              </div>
                            </div>
                          </fieldset>
                        </form>
                      </div>
                      <div class="btn-group" style="margin-top: 24px; width: 120%;">
                        <button class="nhsuk-button nhsuk-button--blue nhsuk-button--small" id="apply-usual-address-btn" style="display:inline-block;">Apply<span class="nhsuk-u-visually-hidden"> usual address</span></button>
                        <a href="#" class="cancel-btn-link" id="cancel-usual-address">Cancel</a>
                      </div>
                    </div>
                  </dd>
                  <dd class="nhsuk-summary-list__actions">
                    <a href="#names" id="change-usual-address">
                      Edit<span class="nhsuk-u-visually-hidden"> address</span>
                    </a>
                  </dd>

                </div>

                <div class="nhsuk-summary-list__row">
                  <dt class="nhsuk-summary-list__key">
                    Correspondence address
                  </dt>
                  <dd class="nhsuk-summary-list__value">
                    None recorded<br />
                    <p class="nhsuk-body-s pds-edit-hint">You can add up to five correspondence addresses.</p>
                  </dd>
                  <dd class="nhsuk-summary-list__actions">
                    <a href="#names" id="change-correspondence-address">
                      Edit<span class="nhsuk-u-visually-hidden"> address</span>
                    </a>
                  </dd>

                </div>

                <div class="nhsuk-summary-list__row">
                  <dt class="nhsuk-summary-list__key">
                    Temporary address
                  </dt>
                  <dd class="nhsuk-summary-list__value">
                    None recorded<br />
                    <p class="nhsuk-body-s pds-edit-hint">You can add one temporary address.</p>
                  </dd>
                  <dd class="nhsuk-summary-list__actions">
                    <a href="#names" id="change-temporary-address">
                      Edit<span class="nhsuk-u-visually-hidden"> name</span>
                    </a>
                  </dd>

                </div>

              </dl>

              <button class="nhsuk-button nhsuk-button--blue" id="add-usual-address-btn" style="display: none;">Add usual address</button>
            </div>
          </div>
        </section>

      </div>

      <section id="save-name-changes" title="Save changes">
        <div class="btn-group">
          <a class="nhsuk-button" href="confirm-address-changes">Save address changes</a>
          <p class="cancel-btn-link"><a href="patient-details">Cancel</a></p>
        </div>
      </section>

    </div>

  </div>

  {% block pageScripts %}
  <script src="https://cdn.jsdelivr.net/npm/places.js@1.19.0"></script>
  <script>
    (function() {
      $('.ap-icon-pin').hide();
      $('.ap-icon-clear').hide();
      var placesAutocomplete = places({
        appId: 'plHXAD50RORF',
        apiKey: 'b08e58629c0e190b4b532116794d6e9b',
        container: document.querySelector('#address-lookup'),
        templates: {
          value: function(suggestion) {
            return suggestion.name;
          }
        }
      }).configure({
        type: 'address'
      });
      placesAutocomplete.on('change', function resultSelected(e) {
        document.querySelector('#pds-edit-house-name').value = e.suggestion.name || '';
        document.querySelector('#pds-edit-post-town').value = e.suggestion.city || '';
        document.querySelector('#pds-edit-postcode').value = e.suggestion.postcode || '';
        document.querySelector('#pds-edit-county').value = e.suggestion.county || '';
        document.querySelector('#address-lookup').value = '';
      });
    })();

    $('.ap-suggestion').click(function() {
      $('.ap-dropdown-menu').hide();
      $('#address-lookup').val("");
    });
  </script>
  <script>
    $("#remove-usual-address-btn").click(function() {
      $(".usual-address-section").hide();
      $("#add-usual-address-btn").show();
      $("#remove-usual-address-btn").hide();
      $('#edit-usual-address-form > .nhsuk-input').val("");
    });

    $("#add-usual-address-btn").click(function() {
      $(".usual-address-section").show();
      $("#cancel-adding-usual-address").show();
      $("#add-usual-address-btn").hide();
    });

    $("#cancel-adding-usual-address").click(function() {
      $(".usual-address-section").hide();
      $("#add-usual-address-btn").show();
    });

    $(".find-postcode__action-link").click(function() {
      $(".lookup-search-results").show();
    });

    $(".lookup-search-results").find("a").click(function() {
      $('#edit-usual-address-form > .nhsuk-input').val("");
      $(".lookup-search-results").hide();
      $("#pds-edit-number").val("1 Henley Street");
      $("#pds-edit-post-town").val("Stratford-upon-Avon");
      $("#pds-edit-county").val("Warwickshire");
      $("#pds-edit-country").val("United Kingdom");
      $("#pds-edit-postcode").val("CV37 6QW");
    });
  </script>
  <script>
    $(document).ready(function() {

      var patientAddress = $('.card-content-detail-address').text();
      patientAddress = patientAddress.replace(/,/g, '<br>');
      $('.card-content-detail-address').html(patientAddress);

    });

    $('#change-usual-address').click(function() {
      $('#change-usual-address').hide()
      $("#usual-address-value").hide();
      $(".usual-address-section").show();
    });

    $('#apply-usual-address-btn').click(function() {
      $('#change-usual-address').show()
      var usualHouse = $("#pds-edit-house-name").val();
      var usualTown = $("#pds-edit-post-town").val();
      var usualCounty = $("#pds-edit-county").val();
      var usualPostcode = $("#pds-edit-postcode").val();
      $("#usual-address-value").html(usualHouse + "<br />" + usualTown + "<br />" + usualCounty + "<br />" + usualPostcode);
      $("#usual-address-value").show();
      $(".usual-address-section").hide();
    });

    $('#cancel-usual-address').click(function() {
      $('#change-usual-address').show()
      $("#usual-address-value").show();
      $(".usual-address-section").hide();
    });
  </script>
  {% endblock %}

  {% endblock %}
